<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="static/style.css">
</head>

<body>
    <div class="container">
        <h2>Admin Panel</h2>
        <table id="usersTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Full Name</th>
                    <th>Phone</th>
                    <th>Date of Birth</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div>
            <button id="logoutBtn">Logout</button>
        </div>
    </div>

    <script>
        fetch('http://localhost:5000/api/users', {
            headers: {
                'Authorization': "Bearer " + localStorage.getItem('token'),
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                var usersTableBody = document.querySelector('#usersTable tbody');
                data.forEach(user => {
                    if (user.role != "admin") {
                        var tr = document.createElement('tr');
                        tr.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${user.full_name}</td>
                    <td>${user.phone}</td>
                    <td>${user.dob}</td>
                    <td>${user.role}</td>
                    <td>
                        <button class="editBtn" data-user-id="${user.id}">Edit</button>
                        <button class="deleteBtn" data-user-id="${user.id}">Delete</button>
                    </td>
                `;
                        usersTableBody.appendChild(tr);
                    }
                });

                // Edit button click event
                document.querySelectorAll('.editBtn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        var userId = this.getAttribute('data-user-id');
                        window.location.href = `edit_user.html?user_id=${userId}`;
                    });
                });

                // Delete button click event
                document.querySelectorAll('.deleteBtn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        var userId = this.getAttribute('data-user-id');
                        alert(userId);
                        fetch(`http://localhost:5000/api/user/${userId}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': "Bearer " + localStorage.getItem('token'),
                                'Content-Type': 'application/json'
                            }
                        })
                            .then(response => response.json())
                            .then(data => {
                                alert(data.message);
                                window.location.reload();
                            });
                    });
                });

                document.getElementById('logoutBtn').addEventListener('click', function () {
                    fetch('http://localhost:5000/api/logout', {
                        method: 'POST'
                    })
                        .then(response => response.json())
                        .then(data => {
                            alert(data.message);
                            localStorage.removeItem('userId');
                            localStorage.removeItem('role');
                            window.location.href = 'index.html';
                        });
                });
            });
    </script>
</body>

</html>